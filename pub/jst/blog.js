var Blog;

Blog = {
  hash: false,
  centry: false,
  title: false,
  i: function() {
    var entry;
    if (Object.keys(entries).indexOf(location.hash.replace('#', '')) !== -1) {
      entry = location.hash.replace('#', '');
      Blog.centry = entry;
      Blog.load(entry);
    } else {
      Blog.summary();
    }
    document.body.scrollTop = document.documentElement.scrollTop = 0;
    return Blog.handlers();
  },
  handlers: function() {
    $('.blog > .summary > .thumbs > .thumb').on('click', Blog.entryHandler);
    $('.blog > .summary > .thumbs > .thumb, .related > .relateds > .thumb').on('click', Blog.entryHandler);
    $('.entry > .details > .tags a').on('click', Blog.tagHandler);
    $('.entry > .details > .author a').on('click', Blog.authorHandler);
    $('.entry > .details > .shares > .share').on('click', Blog.share);
    $('.blog > .summary > .crumb > .close').on('click', Blog.filterReset);
    return $(window).on('popstate', Blog.pop);
  },
  pop: function(e) {
    var entry;
    document.body.scrollTop = document.documentElement.scrollTop = 0;
    if (Object.keys(entries).indexOf(location.hash.replace('#', '')) !== -1) {
      entry = location.hash.replace('#', '');
      Blog.centry = entry;
      return Blog.load(entry);
    } else {
      return Blog.summary();
    }
  },
  share: function() {
    var i, t, type;
    t = $(this);
    type = t.data('type');
    if (type === 'link') {
      _.swap('.share_url');
      _.swap(t);
      i = t.parent().find('.share_url input').first();
      i.val(location.href);
      i[0].setSelectionRange(0, i[0].value.length);
      return true;
    }
    if (type === 'facebook') {
      window.open('https://www.facebook.com/sharer/sharer.php?u=' + location.href, 'Share on Facebook', 'width=626,height=438');
      return true;
    }
    if (type === 'twitter') {
      window.open('https://twitter.com/intent/tweet?url=' + encodeURIComponent(location.href) + '&text=' + encodeURIComponent(Blog.title), 'Share on Twitter', 'width=626,height=438');
      return true;
    }
  },
  filterReset: function() {
    var entry;
    _.off('.crumb');
    _.on('.thumb');
    entry = location.hash = '';
    return Blog.summary();
  },
  tagHandler: function() {
    var tag;
    tag = $(this).text();
    return Blog.tagFilter(tag);
  },
  authorHandler: function() {
    var tag;
    tag = $(this).text();
    return Blog.authorFilter(tag);
  },
  authorFilter: function(author) {
    Blog.summary();
    _.on('.crumb');
    $('.crumb > .copy > span.desc').text('Posts by ');
    $('.crumb > .copy > span.value').text(author);
    return $('.summary > .thumbs > .thumb').each(function(i, el) {
      if (author === $(el).data('author')) {
        return _.on($(el));
      } else {
        return _.off($(el));
      }
    });
  },
  tagFilter: function(tag) {
    Blog.summary();
    _.on('.crumb');
    $('.crumb > .copy > span.desc').text('Filtering by ');
    $('.crumb > .copy > span.value').text(tag);
    return $('.summary > .thumbs > .thumb').each(function(i, el) {
      var tags;
      tags = $(el).data('tags');
      console.log(tags);
      if (tags.indexOf(tag) !== -1) {
        return _.on($(el));
      } else {
        return _.off($(el));
      }
    });
  },
  entryHandler: function() {
    var entry;
    entry = $(this).data('entry');
    location.hash = entry;
    document.body.scrollTop = document.documentElement.scrollTop = 0;
    return Blog.load(entry);
  },
  summary: function() {
    var srcs;
    location.hash = '';
    $('.orbit').removeClass(function(index, css) {
      return (css.match(/\borbit_\S+/g) || []).join(' ');
    });
    $('#nprogress .bar').removeClass(function(index, css) {
      return (css.match(/\bbar__\S+/g) || []).join(' ');
    });
    _.off('.entry');
    _.on('.orbit');
    NProgress.start();
    srcs = [];
    $('.summary > .thumbs > .thumb > .inner').each(function(i, el) {
      return srcs.push(Global.srcFromStyle($(el)));
    });
    return Global.preload(srcs, function(progress) {
      return NProgress.set(progress);
    }, function(complete) {
      NProgress.done();
      _.off('.orbit');
      return _.on('.summary');
    });
  },
  load: function(entry) {
    var srcs;
    _.off('.entry, .summary');
    $('.orbit').addClass("orbit_" + entry);
    $('#nprogress .bar').addClass("bar_" + entry);
    _.on('.orbit');
    NProgress.start();
    $('#nprogress .bar').addClass("bar_" + entry);
    srcs = Blog.srcs(entry);
    return Global.preload(srcs, function(progress) {
      return NProgress.set(progress);
    }, function(complete) {
      NProgress.done();
      _.off('.orbit');
      _.on(".entry_" + entry);
      Blog.title = $(".entry_" + entry + " > .details > .copy > .name").text();
      $('.orbit').removeClass(function(index, css) {
        return (css.match(/\borbit_\S+/g) || []).join(' ');
      });
      return $('#nprogress .bar').removeClass(function(index, css) {
        return (css.match(/\bbar__\S+/g) || []).join(' ');
      });
    });
  },
  srcs: function(entry) {
    var srcs;
    srcs = [Global.srcFromStyle($(".entry_" + entry + " > .cover"))];
    $(".entry_" + entry + " .img").each(function(i, v) {
      return srcs.push(Global.srcFromStyle($(v)));
    });
    return srcs;
  }
};

//# sourceMappingURL=data:application/json;base64,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LEdBQUcsQ0FBQyxLQUFKLENBQVUsY0FBVixDQUFBLElBQTZCLEVBQTlCLENBQWlDLENBQUMsSUFBbEMsQ0FBdUMsR0FBdkM7TUFEc0IsQ0FBeEI7YUFFQSxDQUFBLENBQUUsaUJBQUYsQ0FBb0IsQ0FBQyxXQUFyQixDQUFpQyxTQUFDLEtBQUQsRUFBUSxHQUFSO2VBQy9CLENBQUMsR0FBRyxDQUFDLEtBQUosQ0FBVSxhQUFWLENBQUEsSUFBNEIsRUFBN0IsQ0FBZ0MsQ0FBQyxJQUFqQyxDQUFzQyxHQUF0QztNQUQrQixDQUFqQztJQVRBLENBSEo7RUFYSSxDQTdJTjtFQXVLQSxJQUFBLEVBQU0sU0FBQyxLQUFEO0FBQ0osUUFBQTtJQUFBLElBQUEsR0FBTyxDQUFDLE1BQU0sQ0FBQyxZQUFQLENBQW9CLENBQUEsQ0FBRSxTQUFBLEdBQVUsS0FBVixHQUFnQixXQUFsQixDQUFwQixDQUFEO0lBQ1AsQ0FBQSxDQUFFLFNBQUEsR0FBVSxLQUFWLEdBQWdCLE9BQWxCLENBQXlCLENBQUMsSUFBMUIsQ0FBK0IsU0FBQyxDQUFELEVBQUksQ0FBSjthQUM3QixJQUFJLENBQUMsSUFBTCxDQUFVLE1BQU0sQ0FBQyxZQUFQLENBQW9CLENBQUEsQ0FBRSxDQUFGLENBQXBCLENBQVY7SUFENkIsQ0FBL0I7QUFHQSxXQUFPO0VBTEgsQ0F2S04iLCJmaWxlIjoiYmxvZy5qcyIsInNvdXJjZVJvb3QiOiIvc291cmNlLyIsInNvdXJjZXNDb250ZW50IjpbIkJsb2cgPVxuICBoYXNoOiBmYWxzZVxuICBjZW50cnk6IGZhbHNlXG4gIHRpdGxlOiBmYWxzZVxuXG4gIGk6IC0+XG5cbiAgICBpZiBPYmplY3Qua2V5cyhlbnRyaWVzKS5pbmRleE9mKGxvY2F0aW9uLmhhc2gucmVwbGFjZSgnIycsJycpKSBpc250IC0xXG4gICAgICBlbnRyeSA9IGxvY2F0aW9uLmhhc2gucmVwbGFjZSAnIycsICcnXG4gICAgICBCbG9nLmNlbnRyeSA9IGVudHJ5XG4gICAgICBCbG9nLmxvYWQgZW50cnlcbiAgICBlbHNlXG4gICAgICBCbG9nLnN1bW1hcnkoKVxuXG4gICAgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3AgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wID0gMFxuXG4gICAgQmxvZy5oYW5kbGVycygpXG5cbiAgaGFuZGxlcnM6IC0+XG4gICAgJCgnLmJsb2cgPiAuc3VtbWFyeSA+IC50aHVtYnMgPiAudGh1bWInKS5vbiAnY2xpY2snLCBCbG9nLmVudHJ5SGFuZGxlclxuICAgICQoJy5ibG9nID4gLnN1bW1hcnkgPiAudGh1bWJzID4gLnRodW1iLCAucmVsYXRlZCA+IC5yZWxhdGVkcyA+IC50aHVtYicpLm9uICdjbGljaycsIEJsb2cuZW50cnlIYW5kbGVyXG5cbiAgICAkKCcuZW50cnkgPiAuZGV0YWlscyA+IC50YWdzIGEnKS5vbiAnY2xpY2snLCBCbG9nLnRhZ0hhbmRsZXJcbiAgICAkKCcuZW50cnkgPiAuZGV0YWlscyA+IC5hdXRob3IgYScpLm9uICdjbGljaycsIEJsb2cuYXV0aG9ySGFuZGxlclxuXG4gICAgJCgnLmVudHJ5ID4gLmRldGFpbHMgPiAuc2hhcmVzID4gLnNoYXJlJykub24gJ2NsaWNrJywgQmxvZy5zaGFyZVxuXG4gICAgJCgnLmJsb2cgPiAuc3VtbWFyeSA+IC5jcnVtYiA+IC5jbG9zZScpLm9uICdjbGljaycsIEJsb2cuZmlsdGVyUmVzZXRcblxuICAgICQod2luZG93KS5vbiAncG9wc3RhdGUnLCBCbG9nLnBvcFxuXG4gIHBvcDogKGUpIC0+XG5cbiAgICBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3AgPSAwXG5cbiAgICBpZiBPYmplY3Qua2V5cyhlbnRyaWVzKS5pbmRleE9mKGxvY2F0aW9uLmhhc2gucmVwbGFjZSgnIycsJycpKSBpc250IC0xXG4gICAgICBlbnRyeSA9IGxvY2F0aW9uLmhhc2gucmVwbGFjZSAnIycsICcnXG4gICAgICBCbG9nLmNlbnRyeSA9IGVudHJ5XG4gICAgICBCbG9nLmxvYWQgZW50cnlcbiAgICBlbHNlXG4gICAgICBCbG9nLnN1bW1hcnkoKVxuXG4gIHNoYXJlOiAtPlxuXG4gICAgdCA9ICQgdGhpc1xuICAgIHR5cGUgPSB0LmRhdGEgJ3R5cGUnXG5cbiAgICBpZiB0eXBlID09ICdsaW5rJ1xuICAgICAgXy5zd2FwICcuc2hhcmVfdXJsJ1xuICAgICAgXy5zd2FwIHRcbiAgICAgIGkgPSB0LnBhcmVudCgpLmZpbmQoJy5zaGFyZV91cmwgaW5wdXQnKS5maXJzdCgpXG4gICAgICBpLnZhbChsb2NhdGlvbi5ocmVmKVxuICAgICAgaVswXS5zZXRTZWxlY3Rpb25SYW5nZSgwLCBpWzBdLnZhbHVlLmxlbmd0aClcbiAgICAgICNJdGVtLmFkZFNoYXJlKClcbiAgICAgIHJldHVybiB0cnVlXG5cbiAgICBpZiB0eXBlID09ICdmYWNlYm9vaydcbiAgICAgIHdpbmRvdy5vcGVuICdodHRwczovL3d3dy5mYWNlYm9vay5jb20vc2hhcmVyL3NoYXJlci5waHA/dT0nICsgbG9jYXRpb24uaHJlZiwgJ1NoYXJlIG9uIEZhY2Vib29rJywgJ3dpZHRoPTYyNixoZWlnaHQ9NDM4J1xuICAgICAgI0l0ZW0uYWRkU2hhcmUoKVxuICAgICAgcmV0dXJuIHRydWVcbiAgICBpZiB0eXBlID09ICd0d2l0dGVyJ1xuICAgICAgd2luZG93Lm9wZW4gJ2h0dHBzOi8vdHdpdHRlci5jb20vaW50ZW50L3R3ZWV0P3VybD0nK2VuY29kZVVSSUNvbXBvbmVudChsb2NhdGlvbi5ocmVmKSsnJnRleHQ9JytlbmNvZGVVUklDb21wb25lbnQoQmxvZy50aXRsZSksICdTaGFyZSBvbiBUd2l0dGVyJywgJ3dpZHRoPTYyNixoZWlnaHQ9NDM4J1xuICAgICAgI0l0ZW0uYWRkU2hhcmUoKVxuICAgICAgcmV0dXJuIHRydWVcblxuICBmaWx0ZXJSZXNldDogLT5cbiAgICBfLm9mZiAnLmNydW1iJ1xuICAgIF8ub24gJy50aHVtYidcbiAgICBlbnRyeSA9IGxvY2F0aW9uLmhhc2ggPSAnJ1xuICAgIEJsb2cuc3VtbWFyeSgpXG5cbiAgdGFnSGFuZGxlcjogLT5cbiAgICB0YWcgPSAkKHRoaXMpLnRleHQoKVxuICAgIEJsb2cudGFnRmlsdGVyIHRhZ1xuXG4gIGF1dGhvckhhbmRsZXI6IC0+XG4gICAgdGFnID0gJCh0aGlzKS50ZXh0KClcbiAgICBCbG9nLmF1dGhvckZpbHRlciB0YWdcblxuICBhdXRob3JGaWx0ZXI6IChhdXRob3IpIC0+XG5cbiAgICBCbG9nLnN1bW1hcnkoKVxuXG4gICAgXy5vbiAnLmNydW1iJ1xuICAgICQoJy5jcnVtYiA+IC5jb3B5ID4gc3Bhbi5kZXNjJykudGV4dCAnUG9zdHMgYnkgJ1xuICAgICQoJy5jcnVtYiA+IC5jb3B5ID4gc3Bhbi52YWx1ZScpLnRleHQgYXV0aG9yXG5cbiAgICAkKCcuc3VtbWFyeSA+IC50aHVtYnMgPiAudGh1bWInKS5lYWNoIChpLCBlbCkgLT5cbiAgICAgIGlmIGF1dGhvciBpcyAkKGVsKS5kYXRhICdhdXRob3InXG4gICAgICAgIF8ub24gJChlbClcbiAgICAgIGVsc2VcbiAgICAgICAgXy5vZmYgJChlbClcblxuICB0YWdGaWx0ZXI6ICh0YWcpIC0+XG5cbiAgICBCbG9nLnN1bW1hcnkoKVxuXG4gICAgXy5vbiAnLmNydW1iJ1xuICAgICQoJy5jcnVtYiA+IC5jb3B5ID4gc3Bhbi5kZXNjJykudGV4dCAnRmlsdGVyaW5nIGJ5ICdcbiAgICAkKCcuY3J1bWIgPiAuY29weSA+IHNwYW4udmFsdWUnKS50ZXh0IHRhZ1xuXG4gICAgJCgnLnN1bW1hcnkgPiAudGh1bWJzID4gLnRodW1iJykuZWFjaCAoaSwgZWwpIC0+XG4gICAgICB0YWdzID0gJChlbCkuZGF0YSAndGFncydcbiAgICAgIGNvbnNvbGUubG9nIHRhZ3NcbiAgICAgIGlmIHRhZ3MuaW5kZXhPZih0YWcpIGlzbnQgLTFcbiAgICAgICAgXy5vbiAkKGVsKVxuICAgICAgZWxzZVxuICAgICAgICBfLm9mZiAkKGVsKVxuXG4gIGVudHJ5SGFuZGxlcjogLT5cblxuICAgIGVudHJ5ID0gJCh0aGlzKS5kYXRhICdlbnRyeSdcbiAgICAjaGlzdG9yeS5wdXNoU3RhdGUgbnVsbCwgbnVsbCwgXCIvYmxvZy8jI3tlbnRyeX1cIlxuICAgIGxvY2F0aW9uLmhhc2ggPSBlbnRyeVxuICAgIGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCA9IDBcbiAgICBCbG9nLmxvYWQgZW50cnlcblxuICBzdW1tYXJ5OiAoKSAtPlxuICAgIGxvY2F0aW9uLmhhc2ggPSAnJ1xuXG4gICAgJCgnLm9yYml0JykucmVtb3ZlQ2xhc3MgKGluZGV4LCBjc3MpIC0+XG4gICAgICAoY3NzLm1hdGNoKC9cXGJvcmJpdF9cXFMrL2cpIG9yIFtdKS5qb2luICcgJ1xuICAgICQoJyNucHJvZ3Jlc3MgLmJhcicpLnJlbW92ZUNsYXNzIChpbmRleCwgY3NzKSAtPlxuICAgICAgKGNzcy5tYXRjaCgvXFxiYmFyX19cXFMrL2cpIG9yIFtdKS5qb2luICcgJ1xuXG4gICAgXy5vZmYgJy5lbnRyeSdcbiAgICBfLm9uICcub3JiaXQnXG4gICAgTlByb2dyZXNzLnN0YXJ0KClcblxuICAgIHNyY3MgPSBbXVxuXG4gICAgJCgnLnN1bW1hcnkgPiAudGh1bWJzID4gLnRodW1iID4gLmlubmVyJykuZWFjaCAoaSwgZWwpIC0+XG4gICAgICBzcmNzLnB1c2goR2xvYmFsLnNyY0Zyb21TdHlsZSgkKGVsKSkpXG5cbiAgICBHbG9iYWwucHJlbG9hZCBzcmNzLFxuICAgICAgKHByb2dyZXNzKSAtPlxuICAgICAgICBOUHJvZ3Jlc3Muc2V0IHByb2dyZXNzXG4gICAgICAsIChjb21wbGV0ZSkgLT5cbiAgICAgICAgTlByb2dyZXNzLmRvbmUoKVxuICAgICAgICBfLm9mZiAnLm9yYml0J1xuICAgICAgICBfLm9uICcuc3VtbWFyeSdcblxuICBsb2FkOiAoZW50cnkpIC0+XG4gICAgXy5vZmYgJy5lbnRyeSwgLnN1bW1hcnknXG5cbiAgICAkKCcub3JiaXQnKS5hZGRDbGFzcyBcIm9yYml0XyN7ZW50cnl9XCJcbiAgICAkKCcjbnByb2dyZXNzIC5iYXInKS5hZGRDbGFzcyBcImJhcl8je2VudHJ5fVwiXG5cbiAgICBfLm9uICcub3JiaXQnXG5cbiAgICBOUHJvZ3Jlc3Muc3RhcnQoKVxuICAgICQoJyNucHJvZ3Jlc3MgLmJhcicpLmFkZENsYXNzIFwiYmFyXyN7ZW50cnl9XCJcbiAgICBzcmNzID0gQmxvZy5zcmNzIGVudHJ5XG4gICAgR2xvYmFsLnByZWxvYWQgc3JjcyxcbiAgICAgIChwcm9ncmVzcykgLT5cbiAgICAgICAgTlByb2dyZXNzLnNldCBwcm9ncmVzc1xuICAgICAgLCAoY29tcGxldGUpIC0+XG4gICAgICAgIE5Qcm9ncmVzcy5kb25lKClcbiAgICAgICAgXy5vZmYgJy5vcmJpdCdcbiAgICAgICAgXy5vbiBcIi5lbnRyeV8je2VudHJ5fVwiXG5cbiAgICAgICAgQmxvZy50aXRsZSA9ICQoXCIuZW50cnlfI3tlbnRyeX0gPiAuZGV0YWlscyA+IC5jb3B5ID4gLm5hbWVcIikudGV4dCgpXG5cbiAgICAgICAgJCgnLm9yYml0JykucmVtb3ZlQ2xhc3MgKGluZGV4LCBjc3MpIC0+XG4gICAgICAgICAgKGNzcy5tYXRjaCgvXFxib3JiaXRfXFxTKy9nKSBvciBbXSkuam9pbiAnICdcbiAgICAgICAgJCgnI25wcm9ncmVzcyAuYmFyJykucmVtb3ZlQ2xhc3MgKGluZGV4LCBjc3MpIC0+XG4gICAgICAgICAgKGNzcy5tYXRjaCgvXFxiYmFyX19cXFMrL2cpIG9yIFtdKS5qb2luICcgJ1xuXG4gIHNyY3M6IChlbnRyeSkgLT5cbiAgICBzcmNzID0gW0dsb2JhbC5zcmNGcm9tU3R5bGUoJChcIi5lbnRyeV8je2VudHJ5fSA+IC5jb3ZlclwiKSldXG4gICAgJChcIi5lbnRyeV8je2VudHJ5fSAuaW1nXCIpLmVhY2ggKGksIHYpIC0+XG4gICAgICBzcmNzLnB1c2ggR2xvYmFsLnNyY0Zyb21TdHlsZSgkKHYpKVxuXG4gICAgcmV0dXJuIHNyY3NcblxuXG4iXX0=
