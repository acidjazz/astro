var Work;

Work = {
  hash: false,
  cproject: false,
  i: function() {
    var project;
    if (Object.keys(projects).indexOf(location.hash.replace('#', '')) !== -1) {
      project = location.hash.replace('#', '');
      Work.cproject = project;
      Work.load(project);
    } else {
      Work.summary();
    }
    document.body.scrollTop = document.documentElement.scrollTop = 0;
    return Work.handlers();
  },
  handlers: function() {
    $('.projects > .summary > .thumbs > .thumb, .related > .inner > .relateds > .thumb').on('click', Work.projectHandler);
    $('.project .filters > .inner > .filtermenu > .filter').on('click', Work.filterHandler);
    $('.summary .filters > .inner > .filtermenu > .filter').on('click', Work.summaryFilterHandler);
    $('.project > .description > .filters > .filter').on('click', Work.projectFilterHandler);
    return $(window).on('popstate', Work.pop);
  },
  pop: function(e) {
    var project;
    document.body.scrollTop = document.documentElement.scrollTop = 0;
    if (Object.keys(projects).indexOf(location.hash.replace('#', '')) !== -1) {
      project = location.hash.replace('#', '');
      Work.cproject = project;
      return Work.load(project);
    } else {
      Work.summary();
      _.on('.summary > .thumbs > .thumb');
      _.off('.summary > .filters > .inner > .filtermenu > .filter');
      return _.on('.summary > .filters > .inner > .filtermenu > .filter_all');
    }
  },
  projectFilterHandler: function() {
    var filter;
    filter = $(this).text();
    return Work.summary(filter);
  },
  summaryFilterHandler: function() {
    var copy, filter;
    filter = $(this).text().trim();
    copy = $(this).data('copy');
    return Work.summaryFilter(filter, copy);
  },
  summaryFilter: function(filter, copy) {
    _.off('.summary .filters > .inner > .filtermenu > .filter');
    _.on(".summary .filters > .inner > .filtermenu > .filter.filter_" + filter);
    if (copy) {
      $('.summary > .hero > .copy2').text(copy);
    }
    if (filter === 'all') {
      _.on('.summary > .thumbs > .thumb');
      return true;
    }
    _.off('.summary > .thumbs > .thumb');
    return setTimeout(function() {
      return $('.summary > .thumbs > .thumb').each(function(i, el) {
        var filters;
        filters = $(el).data('filters');
        if (filters.indexOf(filter) !== -1) {
          return _.on($(el));
        } else {
          return _.off($(el));
        }
      });
    }, 200);
  },
  filterHandler: function() {
    var t;
    t = $(this);
    return $('html, body').animate({
      scrollTop: $(".filter_mark.filter_" + (t.html())).offset().top
    }, 500);
  },
  projectHandler: function() {
    var project;
    project = $(this).data('project');
    history.pushState(null, null, "/work/#" + project);
    document.body.scrollTop = document.documentElement.scrollTop = 0;
    return Work.load(project);
  },
  summary: function(filter) {
    var srcs;
    location.hash = '';
    $('.orbit').removeClass(function(index, css) {
      return (css.match(/\borbit_\S+/g) || []).join(' ');
    });
    $('.dbar').removeClass(function(index, css) {
      return (css.match(/\bbar_\S+/g) || []).join(' ');
    });
    _.off('.project');
    _.on('.orbit');
    dbar.i();
    srcs = [];
    $('.summary > .thumbs > .thumb > .inner').each(function(i, el) {
      return srcs.push(Global.srcFromStyle($(el)));
    });
    return Global.preload(srcs, function(progress) {
      return dbar.perc(progress);
    }, function(complete) {
      dbar.d();
      _.off('.orbit');
      _.on('.summary');
      if (filter) {
        return Work.summaryFilter(filter);
      }
    });
  },
  load: function(project) {
    var srcs;
    _.off('.project, .summary');
    $('.orbit').addClass("orbit_" + project);
    $('.dbar').addClass("bar_" + project);
    _.on('.orbit');
    dbar.i();
    $('.dbar').addClass("bar_" + project);
    srcs = Work.srcs(project);
    document.body.scrollTop = document.documentElement.scrollTop = 0;
    return Global.preload(srcs, function(progress) {
      return dbar.perc(progress);
    }, function(complete) {
      dbar.d();
      _.off('.orbit');
      $(".project img").attr('src', '');
      $(".project_" + project + " img").each(function(i, v) {
        return $(v).attr('src', "/img/work/" + project + "/1440/" + ($(v).data('src')));
      });
      _.on(".project_" + project);
      return setTimeout(function() {
        $('.orbit').removeClass(function(index, css) {
          return (css.match(/\borbit_\S+/g) || []).join(' ');
        });
        return $('.dbar').removeClass(function(index, css) {
          return (css.match(/\bbar_\S+/g) || []).join(' ');
        });
      }, 500);
    });
  },
  srcs: function(project) {
    var srcs;
    srcs = [Global.srcFromStyle($(".project_" + project + " > .cover"))];
    $(".project_" + project + " img").each(function(i, v) {
      return srcs.push("/img/work/" + project + "/1440/" + ($(v).data('src')));
    });
    return srcs;
  }
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndvcmsuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLElBQUE7O0FBQUEsSUFBQSxHQUNFO0VBQUEsSUFBQSxFQUFNLEtBQU47RUFDQSxRQUFBLEVBQVUsS0FEVjtFQUdBLENBQUEsRUFBRyxTQUFBO0FBQ0QsUUFBQTtJQUFBLElBQUcsTUFBTSxDQUFDLElBQVAsQ0FBWSxRQUFaLENBQXFCLENBQUMsT0FBdEIsQ0FBOEIsUUFBUSxDQUFDLElBQUksQ0FBQyxPQUFkLENBQXNCLEdBQXRCLEVBQTBCLEVBQTFCLENBQTlCLENBQUEsS0FBa0UsQ0FBQyxDQUF0RTtNQUNFLE9BQUEsR0FBVSxRQUFRLENBQUMsSUFBSSxDQUFDLE9BQWQsQ0FBc0IsR0FBdEIsRUFBMkIsRUFBM0I7TUFDVixJQUFJLENBQUMsUUFBTCxHQUFnQjtNQUNoQixJQUFJLENBQUMsSUFBTCxDQUFVLE9BQVYsRUFIRjtLQUFBLE1BQUE7TUFLRSxJQUFJLENBQUMsT0FBTCxDQUFBLEVBTEY7O0lBT0EsUUFBUSxDQUFDLElBQUksQ0FBQyxTQUFkLEdBQTBCLFFBQVEsQ0FBQyxlQUFlLENBQUMsU0FBekIsR0FBcUM7V0FFL0QsSUFBSSxDQUFDLFFBQUwsQ0FBQTtFQVZDLENBSEg7RUFlQSxRQUFBLEVBQVUsU0FBQTtJQUVSLENBQUEsQ0FBRSxpRkFBRixDQUFvRixDQUFDLEVBQXJGLENBQXdGLE9BQXhGLEVBQWlHLElBQUksQ0FBQyxjQUF0RztJQUNBLENBQUEsQ0FBRSxvREFBRixDQUF1RCxDQUFDLEVBQXhELENBQTJELE9BQTNELEVBQW9FLElBQUksQ0FBQyxhQUF6RTtJQUNBLENBQUEsQ0FBRSxvREFBRixDQUF1RCxDQUFDLEVBQXhELENBQTJELE9BQTNELEVBQW9FLElBQUksQ0FBQyxvQkFBekU7SUFDQSxDQUFBLENBQUUsOENBQUYsQ0FBaUQsQ0FBQyxFQUFsRCxDQUFxRCxPQUFyRCxFQUE4RCxJQUFJLENBQUMsb0JBQW5FO1dBQ0EsQ0FBQSxDQUFFLE1BQUYsQ0FBUyxDQUFDLEVBQVYsQ0FBYSxVQUFiLEVBQXlCLElBQUksQ0FBQyxHQUE5QjtFQU5RLENBZlY7RUF1QkEsR0FBQSxFQUFLLFNBQUMsQ0FBRDtBQUVILFFBQUE7SUFBQSxRQUFRLENBQUMsSUFBSSxDQUFDLFNBQWQsR0FBMEIsUUFBUSxDQUFDLGVBQWUsQ0FBQyxTQUF6QixHQUFxQztJQUUvRCxJQUFHLE1BQU0sQ0FBQyxJQUFQLENBQVksUUFBWixDQUFxQixDQUFDLE9BQXRCLENBQThCLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBZCxDQUFzQixHQUF0QixFQUEwQixFQUExQixDQUE5QixDQUFBLEtBQWtFLENBQUMsQ0FBdEU7TUFDRSxPQUFBLEdBQVUsUUFBUSxDQUFDLElBQUksQ0FBQyxPQUFkLENBQXNCLEdBQXRCLEVBQTJCLEVBQTNCO01BQ1YsSUFBSSxDQUFDLFFBQUwsR0FBZ0I7YUFDaEIsSUFBSSxDQUFDLElBQUwsQ0FBVSxPQUFWLEVBSEY7S0FBQSxNQUFBO01BS0UsSUFBSSxDQUFDLE9BQUwsQ0FBQTtNQUNBLENBQUMsQ0FBQyxFQUFGLENBQUssNkJBQUw7TUFDQSxDQUFDLENBQUMsR0FBRixDQUFNLHNEQUFOO2FBQ0EsQ0FBQyxDQUFDLEVBQUYsQ0FBSywwREFBTCxFQVJGOztFQUpHLENBdkJMO0VBcUNBLG9CQUFBLEVBQXNCLFNBQUE7QUFFcEIsUUFBQTtJQUFBLE1BQUEsR0FBUyxDQUFBLENBQUUsSUFBRixDQUFPLENBQUMsSUFBUixDQUFBO1dBQ1QsSUFBSSxDQUFDLE9BQUwsQ0FBYSxNQUFiO0VBSG9CLENBckN0QjtFQTBDQSxvQkFBQSxFQUFzQixTQUFBO0FBQ3BCLFFBQUE7SUFBQSxNQUFBLEdBQVMsQ0FBQSxDQUFFLElBQUYsQ0FBTyxDQUFDLElBQVIsQ0FBQSxDQUFjLENBQUMsSUFBZixDQUFBO0lBQ1QsSUFBQSxHQUFPLENBQUEsQ0FBRSxJQUFGLENBQU8sQ0FBQyxJQUFSLENBQWEsTUFBYjtXQUNQLElBQUksQ0FBQyxhQUFMLENBQW1CLE1BQW5CLEVBQTJCLElBQTNCO0VBSG9CLENBMUN0QjtFQStDQSxhQUFBLEVBQWUsU0FBQyxNQUFELEVBQVMsSUFBVDtJQUliLENBQUMsQ0FBQyxHQUFGLENBQU0sb0RBQU47SUFDQSxDQUFDLENBQUMsRUFBRixDQUFLLDREQUFBLEdBQTZELE1BQWxFO0lBRUEsSUFBNEMsSUFBNUM7TUFBQSxDQUFBLENBQUUsMkJBQUYsQ0FBOEIsQ0FBQyxJQUEvQixDQUFvQyxJQUFwQyxFQUFBOztJQUVBLElBQUcsTUFBQSxLQUFVLEtBQWI7TUFDRSxDQUFDLENBQUMsRUFBRixDQUFLLDZCQUFMO0FBQ0EsYUFBTyxLQUZUOztJQUlBLENBQUMsQ0FBQyxHQUFGLENBQU0sNkJBQU47V0FDQSxVQUFBLENBQVcsU0FBQTthQUNULENBQUEsQ0FBRSw2QkFBRixDQUFnQyxDQUFDLElBQWpDLENBQXNDLFNBQUMsQ0FBRCxFQUFJLEVBQUo7QUFDcEMsWUFBQTtRQUFBLE9BQUEsR0FBVSxDQUFBLENBQUUsRUFBRixDQUFLLENBQUMsSUFBTixDQUFXLFNBQVg7UUFDVixJQUFHLE9BQU8sQ0FBQyxPQUFSLENBQWdCLE1BQWhCLENBQUEsS0FBNkIsQ0FBQyxDQUFqQztpQkFDRSxDQUFDLENBQUMsRUFBRixDQUFLLENBQUEsQ0FBRSxFQUFGLENBQUwsRUFERjtTQUFBLE1BQUE7aUJBR0UsQ0FBQyxDQUFDLEdBQUYsQ0FBTSxDQUFBLENBQUUsRUFBRixDQUFOLEVBSEY7O01BRm9DLENBQXRDO0lBRFMsQ0FBWCxFQU9FLEdBUEY7RUFkYSxDQS9DZjtFQXNFQSxhQUFBLEVBQWUsU0FBQTtBQUNiLFFBQUE7SUFBQSxDQUFBLEdBQUksQ0FBQSxDQUFFLElBQUY7V0FDSixDQUFBLENBQUUsWUFBRixDQUFlLENBQUMsT0FBaEIsQ0FDRTtNQUFBLFNBQUEsRUFBVyxDQUFBLENBQUUsc0JBQUEsR0FBc0IsQ0FBQyxDQUFDLENBQUMsSUFBRixDQUFBLENBQUQsQ0FBeEIsQ0FBb0MsQ0FBQyxNQUFyQyxDQUFBLENBQTZDLENBQUMsR0FBekQ7S0FERixFQUVFLEdBRkY7RUFGYSxDQXRFZjtFQTRFQSxjQUFBLEVBQWdCLFNBQUE7QUFFZCxRQUFBO0lBQUEsT0FBQSxHQUFVLENBQUEsQ0FBRSxJQUFGLENBQU8sQ0FBQyxJQUFSLENBQWEsU0FBYjtJQUNWLE9BQU8sQ0FBQyxTQUFSLENBQWtCLElBQWxCLEVBQXdCLElBQXhCLEVBQThCLFNBQUEsR0FBVSxPQUF4QztJQUVBLFFBQVEsQ0FBQyxJQUFJLENBQUMsU0FBZCxHQUEwQixRQUFRLENBQUMsZUFBZSxDQUFDLFNBQXpCLEdBQXFDO1dBQy9ELElBQUksQ0FBQyxJQUFMLENBQVUsT0FBVjtFQU5jLENBNUVoQjtFQW9GQSxPQUFBLEVBQVMsU0FBQyxNQUFEO0FBRVAsUUFBQTtJQUFBLFFBQVEsQ0FBQyxJQUFULEdBQWdCO0lBRWhCLENBQUEsQ0FBRSxRQUFGLENBQVcsQ0FBQyxXQUFaLENBQXdCLFNBQUMsS0FBRCxFQUFRLEdBQVI7YUFDdEIsQ0FBQyxHQUFHLENBQUMsS0FBSixDQUFVLGNBQVYsQ0FBQSxJQUE2QixFQUE5QixDQUFpQyxDQUFDLElBQWxDLENBQXVDLEdBQXZDO0lBRHNCLENBQXhCO0lBRUEsQ0FBQSxDQUFFLE9BQUYsQ0FBVSxDQUFDLFdBQVgsQ0FBdUIsU0FBQyxLQUFELEVBQVEsR0FBUjthQUNyQixDQUFDLEdBQUcsQ0FBQyxLQUFKLENBQVUsWUFBVixDQUFBLElBQTJCLEVBQTVCLENBQStCLENBQUMsSUFBaEMsQ0FBcUMsR0FBckM7SUFEcUIsQ0FBdkI7SUFHQSxDQUFDLENBQUMsR0FBRixDQUFNLFVBQU47SUFDQSxDQUFDLENBQUMsRUFBRixDQUFLLFFBQUw7SUFDQSxJQUFJLENBQUMsQ0FBTCxDQUFBO0lBRUEsSUFBQSxHQUFPO0lBRVAsQ0FBQSxDQUFFLHNDQUFGLENBQXlDLENBQUMsSUFBMUMsQ0FBK0MsU0FBQyxDQUFELEVBQUksRUFBSjthQUM3QyxJQUFJLENBQUMsSUFBTCxDQUFVLE1BQU0sQ0FBQyxZQUFQLENBQW9CLENBQUEsQ0FBRSxFQUFGLENBQXBCLENBQVY7SUFENkMsQ0FBL0M7V0FHQSxNQUFNLENBQUMsT0FBUCxDQUFlLElBQWYsRUFDRSxTQUFDLFFBQUQ7YUFDRSxJQUFJLENBQUMsSUFBTCxDQUFVLFFBQVY7SUFERixDQURGLEVBR0ksU0FBQyxRQUFEO01BQ0EsSUFBSSxDQUFDLENBQUwsQ0FBQTtNQUNBLENBQUMsQ0FBQyxHQUFGLENBQU0sUUFBTjtNQUNBLENBQUMsQ0FBQyxFQUFGLENBQUssVUFBTDtNQUNBLElBQThCLE1BQTlCO2VBQUEsSUFBSSxDQUFDLGFBQUwsQ0FBbUIsTUFBbkIsRUFBQTs7SUFKQSxDQUhKO0VBbEJPLENBcEZUO0VBK0dBLElBQUEsRUFBTSxTQUFDLE9BQUQ7QUFFSixRQUFBO0lBQUEsQ0FBQyxDQUFDLEdBQUYsQ0FBTSxvQkFBTjtJQUVBLENBQUEsQ0FBRSxRQUFGLENBQVcsQ0FBQyxRQUFaLENBQXFCLFFBQUEsR0FBUyxPQUE5QjtJQUNBLENBQUEsQ0FBRSxPQUFGLENBQVUsQ0FBQyxRQUFYLENBQW9CLE1BQUEsR0FBTyxPQUEzQjtJQUVBLENBQUMsQ0FBQyxFQUFGLENBQUssUUFBTDtJQUNBLElBQUksQ0FBQyxDQUFMLENBQUE7SUFDQSxDQUFBLENBQUUsT0FBRixDQUFVLENBQUMsUUFBWCxDQUFvQixNQUFBLEdBQU8sT0FBM0I7SUFDQSxJQUFBLEdBQU8sSUFBSSxDQUFDLElBQUwsQ0FBVSxPQUFWO0lBRVAsUUFBUSxDQUFDLElBQUksQ0FBQyxTQUFkLEdBQTBCLFFBQVEsQ0FBQyxlQUFlLENBQUMsU0FBekIsR0FBcUM7V0FFL0QsTUFBTSxDQUFDLE9BQVAsQ0FBZSxJQUFmLEVBQ0UsU0FBQyxRQUFEO2FBQ0UsSUFBSSxDQUFDLElBQUwsQ0FBVSxRQUFWO0lBREYsQ0FERixFQUdJLFNBQUMsUUFBRDtNQUNBLElBQUksQ0FBQyxDQUFMLENBQUE7TUFDQSxDQUFDLENBQUMsR0FBRixDQUFNLFFBQU47TUFDQSxDQUFBLENBQUUsY0FBRixDQUFpQixDQUFDLElBQWxCLENBQXVCLEtBQXZCLEVBQThCLEVBQTlCO01BRUEsQ0FBQSxDQUFFLFdBQUEsR0FBWSxPQUFaLEdBQW9CLE1BQXRCLENBQTRCLENBQUMsSUFBN0IsQ0FBa0MsU0FBQyxDQUFELEVBQUksQ0FBSjtlQUNoQyxDQUFBLENBQUUsQ0FBRixDQUFJLENBQUMsSUFBTCxDQUFVLEtBQVYsRUFBaUIsWUFBQSxHQUFhLE9BQWIsR0FBcUIsUUFBckIsR0FBNEIsQ0FBQyxDQUFBLENBQUUsQ0FBRixDQUFJLENBQUMsSUFBTCxDQUFVLEtBQVYsQ0FBRCxDQUE3QztNQURnQyxDQUFsQztNQUdBLENBQUMsQ0FBQyxFQUFGLENBQUssV0FBQSxHQUFZLE9BQWpCO2FBRUEsVUFBQSxDQUFXLFNBQUE7UUFDVCxDQUFBLENBQUUsUUFBRixDQUFXLENBQUMsV0FBWixDQUF3QixTQUFDLEtBQUQsRUFBUSxHQUFSO2lCQUN0QixDQUFDLEdBQUcsQ0FBQyxLQUFKLENBQVUsY0FBVixDQUFBLElBQTZCLEVBQTlCLENBQWlDLENBQUMsSUFBbEMsQ0FBdUMsR0FBdkM7UUFEc0IsQ0FBeEI7ZUFFQSxDQUFBLENBQUUsT0FBRixDQUFVLENBQUMsV0FBWCxDQUF1QixTQUFDLEtBQUQsRUFBUSxHQUFSO2lCQUNyQixDQUFDLEdBQUcsQ0FBQyxLQUFKLENBQVUsWUFBVixDQUFBLElBQTJCLEVBQTVCLENBQStCLENBQUMsSUFBaEMsQ0FBcUMsR0FBckM7UUFEcUIsQ0FBdkI7TUFIUyxDQUFYLEVBS0UsR0FMRjtJQVZBLENBSEo7RUFkSSxDQS9HTjtFQWlKQSxJQUFBLEVBQU0sU0FBQyxPQUFEO0FBRUosUUFBQTtJQUFBLElBQUEsR0FBTyxDQUFDLE1BQU0sQ0FBQyxZQUFQLENBQW9CLENBQUEsQ0FBRSxXQUFBLEdBQVksT0FBWixHQUFvQixXQUF0QixDQUFwQixDQUFEO0lBRVAsQ0FBQSxDQUFFLFdBQUEsR0FBWSxPQUFaLEdBQW9CLE1BQXRCLENBQTRCLENBQUMsSUFBN0IsQ0FBa0MsU0FBQyxDQUFELEVBQUksQ0FBSjthQUNoQyxJQUFJLENBQUMsSUFBTCxDQUFVLFlBQUEsR0FBYSxPQUFiLEdBQXFCLFFBQXJCLEdBQTRCLENBQUMsQ0FBQSxDQUFFLENBQUYsQ0FBSSxDQUFDLElBQUwsQ0FBVSxLQUFWLENBQUQsQ0FBdEM7SUFEZ0MsQ0FBbEM7QUFHQSxXQUFPO0VBUEgsQ0FqSk4iLCJmaWxlIjoid29yay5qcyIsInNvdXJjZVJvb3QiOiIvc291cmNlLyIsInNvdXJjZXNDb250ZW50IjpbIlxuV29yayA9XG4gIGhhc2g6IGZhbHNlXG4gIGNwcm9qZWN0OiBmYWxzZVxuXG4gIGk6IC0+XG4gICAgaWYgT2JqZWN0LmtleXMocHJvamVjdHMpLmluZGV4T2YobG9jYXRpb24uaGFzaC5yZXBsYWNlKCcjJywnJykpIGlzbnQgLTFcbiAgICAgIHByb2plY3QgPSBsb2NhdGlvbi5oYXNoLnJlcGxhY2UgJyMnLCAnJ1xuICAgICAgV29yay5jcHJvamVjdCA9IHByb2plY3RcbiAgICAgIFdvcmsubG9hZCBwcm9qZWN0XG4gICAgZWxzZVxuICAgICAgV29yay5zdW1tYXJ5KClcblxuICAgIGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCA9IDBcblxuICAgIFdvcmsuaGFuZGxlcnMoKVxuXG4gIGhhbmRsZXJzOiAtPlxuXG4gICAgJCgnLnByb2plY3RzID4gLnN1bW1hcnkgPiAudGh1bWJzID4gLnRodW1iLCAucmVsYXRlZCA+IC5pbm5lciA+IC5yZWxhdGVkcyA+IC50aHVtYicpLm9uICdjbGljaycsIFdvcmsucHJvamVjdEhhbmRsZXJcbiAgICAkKCcucHJvamVjdCAuZmlsdGVycyA+IC5pbm5lciA+IC5maWx0ZXJtZW51ID4gLmZpbHRlcicpLm9uICdjbGljaycsIFdvcmsuZmlsdGVySGFuZGxlclxuICAgICQoJy5zdW1tYXJ5IC5maWx0ZXJzID4gLmlubmVyID4gLmZpbHRlcm1lbnUgPiAuZmlsdGVyJykub24gJ2NsaWNrJywgV29yay5zdW1tYXJ5RmlsdGVySGFuZGxlclxuICAgICQoJy5wcm9qZWN0ID4gLmRlc2NyaXB0aW9uID4gLmZpbHRlcnMgPiAuZmlsdGVyJykub24gJ2NsaWNrJywgV29yay5wcm9qZWN0RmlsdGVySGFuZGxlclxuICAgICQod2luZG93KS5vbiAncG9wc3RhdGUnLCBXb3JrLnBvcFxuXG4gIHBvcDogKGUpIC0+XG5cbiAgICBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3AgPSAwXG5cbiAgICBpZiBPYmplY3Qua2V5cyhwcm9qZWN0cykuaW5kZXhPZihsb2NhdGlvbi5oYXNoLnJlcGxhY2UoJyMnLCcnKSkgaXNudCAtMVxuICAgICAgcHJvamVjdCA9IGxvY2F0aW9uLmhhc2gucmVwbGFjZSAnIycsICcnXG4gICAgICBXb3JrLmNwcm9qZWN0ID0gcHJvamVjdFxuICAgICAgV29yay5sb2FkIHByb2plY3RcbiAgICBlbHNlXG4gICAgICBXb3JrLnN1bW1hcnkoKVxuICAgICAgXy5vbiAnLnN1bW1hcnkgPiAudGh1bWJzID4gLnRodW1iJ1xuICAgICAgXy5vZmYgJy5zdW1tYXJ5ID4gLmZpbHRlcnMgPiAuaW5uZXIgPiAuZmlsdGVybWVudSA+IC5maWx0ZXInXG4gICAgICBfLm9uICcuc3VtbWFyeSA+IC5maWx0ZXJzID4gLmlubmVyID4gLmZpbHRlcm1lbnUgPiAuZmlsdGVyX2FsbCdcblxuICBwcm9qZWN0RmlsdGVySGFuZGxlcjogLT5cblxuICAgIGZpbHRlciA9ICQodGhpcykudGV4dCgpXG4gICAgV29yay5zdW1tYXJ5KGZpbHRlcilcblxuICBzdW1tYXJ5RmlsdGVySGFuZGxlcjogLT5cbiAgICBmaWx0ZXIgPSAkKHRoaXMpLnRleHQoKS50cmltKClcbiAgICBjb3B5ID0gJCh0aGlzKS5kYXRhICdjb3B5J1xuICAgIFdvcmsuc3VtbWFyeUZpbHRlciBmaWx0ZXIsIGNvcHlcblxuICBzdW1tYXJ5RmlsdGVyOiAoZmlsdGVyLCBjb3B5KSAtPlxuXG4gICAgI2RvY3VtZW50LmJvZHkuc2Nyb2xsVG9wID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCA9IDBcblxuICAgIF8ub2ZmICcuc3VtbWFyeSAuZmlsdGVycyA+IC5pbm5lciA+IC5maWx0ZXJtZW51ID4gLmZpbHRlcidcbiAgICBfLm9uIFwiLnN1bW1hcnkgLmZpbHRlcnMgPiAuaW5uZXIgPiAuZmlsdGVybWVudSA+IC5maWx0ZXIuZmlsdGVyXyN7ZmlsdGVyfVwiXG5cbiAgICAkKCcuc3VtbWFyeSA+IC5oZXJvID4gLmNvcHkyJykudGV4dCBjb3B5IGlmIGNvcHlcblxuICAgIGlmIGZpbHRlciBpcyAnYWxsJ1xuICAgICAgXy5vbiAnLnN1bW1hcnkgPiAudGh1bWJzID4gLnRodW1iJ1xuICAgICAgcmV0dXJuIHRydWVcblxuICAgIF8ub2ZmICcuc3VtbWFyeSA+IC50aHVtYnMgPiAudGh1bWInXG4gICAgc2V0VGltZW91dCAtPlxuICAgICAgJCgnLnN1bW1hcnkgPiAudGh1bWJzID4gLnRodW1iJykuZWFjaCAoaSwgZWwpIC0+XG4gICAgICAgIGZpbHRlcnMgPSAkKGVsKS5kYXRhICdmaWx0ZXJzJ1xuICAgICAgICBpZiBmaWx0ZXJzLmluZGV4T2YoZmlsdGVyKSBpc250IC0xXG4gICAgICAgICAgXy5vbiAkKGVsKVxuICAgICAgICBlbHNlXG4gICAgICAgICAgXy5vZmYgJChlbClcbiAgICAsIDIwMFxuXG4gIGZpbHRlckhhbmRsZXI6IC0+XG4gICAgdCA9ICQgdGhpc1xuICAgICQoJ2h0bWwsIGJvZHknKS5hbmltYXRlKFxuICAgICAgc2Nyb2xsVG9wOiAkKFwiLmZpbHRlcl9tYXJrLmZpbHRlcl8je3QuaHRtbCgpfVwiKS5vZmZzZXQoKS50b3BcbiAgICAsIDUwMClcblxuICBwcm9qZWN0SGFuZGxlcjogLT5cblxuICAgIHByb2plY3QgPSAkKHRoaXMpLmRhdGEgJ3Byb2plY3QnXG4gICAgaGlzdG9yeS5wdXNoU3RhdGUgbnVsbCwgbnVsbCwgXCIvd29yay8jI3twcm9qZWN0fVwiXG5cbiAgICBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3AgPSAwXG4gICAgV29yay5sb2FkIHByb2plY3RcblxuICBzdW1tYXJ5OiAoZmlsdGVyKSAtPlxuXG4gICAgbG9jYXRpb24uaGFzaCA9ICcnXG5cbiAgICAkKCcub3JiaXQnKS5yZW1vdmVDbGFzcyAoaW5kZXgsIGNzcykgLT5cbiAgICAgIChjc3MubWF0Y2goL1xcYm9yYml0X1xcUysvZykgb3IgW10pLmpvaW4gJyAnXG4gICAgJCgnLmRiYXInKS5yZW1vdmVDbGFzcyAoaW5kZXgsIGNzcykgLT5cbiAgICAgIChjc3MubWF0Y2goL1xcYmJhcl9cXFMrL2cpIG9yIFtdKS5qb2luICcgJ1xuXG4gICAgXy5vZmYgJy5wcm9qZWN0J1xuICAgIF8ub24gJy5vcmJpdCdcbiAgICBkYmFyLmkoKVxuXG4gICAgc3JjcyA9IFtdXG5cbiAgICAkKCcuc3VtbWFyeSA+IC50aHVtYnMgPiAudGh1bWIgPiAuaW5uZXInKS5lYWNoIChpLCBlbCkgLT5cbiAgICAgIHNyY3MucHVzaChHbG9iYWwuc3JjRnJvbVN0eWxlKCQoZWwpKSlcblxuICAgIEdsb2JhbC5wcmVsb2FkIHNyY3MsXG4gICAgICAocHJvZ3Jlc3MpIC0+XG4gICAgICAgIGRiYXIucGVyYyBwcm9ncmVzc1xuICAgICAgLCAoY29tcGxldGUpIC0+XG4gICAgICAgIGRiYXIuZCgpXG4gICAgICAgIF8ub2ZmICcub3JiaXQnXG4gICAgICAgIF8ub24gJy5zdW1tYXJ5J1xuICAgICAgICBXb3JrLnN1bW1hcnlGaWx0ZXIoZmlsdGVyKSBpZiBmaWx0ZXJcblxuICBsb2FkOiAocHJvamVjdCkgLT5cblxuICAgIF8ub2ZmICcucHJvamVjdCwgLnN1bW1hcnknXG5cbiAgICAkKCcub3JiaXQnKS5hZGRDbGFzcyBcIm9yYml0XyN7cHJvamVjdH1cIlxuICAgICQoJy5kYmFyJykuYWRkQ2xhc3MgXCJiYXJfI3twcm9qZWN0fVwiXG5cbiAgICBfLm9uICcub3JiaXQnXG4gICAgZGJhci5pKClcbiAgICAkKCcuZGJhcicpLmFkZENsYXNzIFwiYmFyXyN7cHJvamVjdH1cIlxuICAgIHNyY3MgPSBXb3JrLnNyY3MgcHJvamVjdFxuXG4gICAgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3AgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wID0gMFxuXG4gICAgR2xvYmFsLnByZWxvYWQgc3JjcyxcbiAgICAgIChwcm9ncmVzcykgLT5cbiAgICAgICAgZGJhci5wZXJjIHByb2dyZXNzXG4gICAgICAsIChjb21wbGV0ZSkgLT5cbiAgICAgICAgZGJhci5kKClcbiAgICAgICAgXy5vZmYgJy5vcmJpdCdcbiAgICAgICAgJChcIi5wcm9qZWN0IGltZ1wiKS5hdHRyICdzcmMnLCAnJ1xuXG4gICAgICAgICQoXCIucHJvamVjdF8je3Byb2plY3R9IGltZ1wiKS5lYWNoIChpLCB2KSAtPlxuICAgICAgICAgICQodikuYXR0ciAnc3JjJywgXCIvaW1nL3dvcmsvI3twcm9qZWN0fS8xNDQwLyN7JCh2KS5kYXRhKCdzcmMnKX1cIlxuXG4gICAgICAgIF8ub24gXCIucHJvamVjdF8je3Byb2plY3R9XCJcbiAgICAgICAgXG4gICAgICAgIHNldFRpbWVvdXQgLT5cbiAgICAgICAgICAkKCcub3JiaXQnKS5yZW1vdmVDbGFzcyAoaW5kZXgsIGNzcykgLT5cbiAgICAgICAgICAgIChjc3MubWF0Y2goL1xcYm9yYml0X1xcUysvZykgb3IgW10pLmpvaW4gJyAnXG4gICAgICAgICAgJCgnLmRiYXInKS5yZW1vdmVDbGFzcyAoaW5kZXgsIGNzcykgLT5cbiAgICAgICAgICAgIChjc3MubWF0Y2goL1xcYmJhcl9cXFMrL2cpIG9yIFtdKS5qb2luICcgJ1xuICAgICAgICAsIDUwMFxuXG4gIHNyY3M6IChwcm9qZWN0KSAtPlxuXG4gICAgc3JjcyA9IFtHbG9iYWwuc3JjRnJvbVN0eWxlKCQoXCIucHJvamVjdF8je3Byb2plY3R9ID4gLmNvdmVyXCIpKV1cblxuICAgICQoXCIucHJvamVjdF8je3Byb2plY3R9IGltZ1wiKS5lYWNoIChpLCB2KSAtPlxuICAgICAgc3Jjcy5wdXNoIFwiL2ltZy93b3JrLyN7cHJvamVjdH0vMTQ0MC8jeyQodikuZGF0YSgnc3JjJyl9XCJcblxuICAgIHJldHVybiBzcmNzXG5cblxuIl19
