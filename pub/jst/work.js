var Work;

Work = {
  hash: false,
  cproject: false,
  i: function() {
    var project;
    if (Object.keys(projects).indexOf(location.hash.replace('#', '')) !== -1) {
      project = location.hash.replace('#', '');
      Work.cproject = project;
      Work.load(project);
    } else {
      Work.summary();
    }
    document.body.scrollTop = document.documentElement.scrollTop = 0;
    return Work.handlers();
  },
  handlers: function() {
    $('.projects > .summary > .thumbs > .thumb, .related > .inner > .relateds > .thumb').on('click', Work.projectHandler);
    $('.project .filters > .inner > .filtermenu > .filter').on('click', Work.filterHandler);
    $('.summary .filters > .inner > .filtermenu > .filter').on('click', Work.summaryFilterHandler);
    $('.project > .description > .filters > .filter').on('click', Work.projectFilterHandler);
    return $(window).on('popstate', Work.pop);
  },
  pop: function(e) {
    var project;
    document.body.scrollTop = document.documentElement.scrollTop = 0;
    if (Object.keys(projects).indexOf(location.hash.replace('#', '')) !== -1) {
      project = location.hash.replace('#', '');
      Work.cproject = project;
      return Work.load(project);
    } else {
      Work.summary();
      _.on('.summary > .thumbs > .thumb');
      _.off('.summary > .filters > .inner > .filtermenu > .filter');
      return _.on('.summary > .filters > .inner > .filtermenu > .filter_all');
    }
  },
  projectFilterHandler: function() {
    var filter;
    filter = $(this).text();
    return Work.summary(filter);
  },
  summaryFilterHandler: function() {
    var copy, filter;
    filter = $(this).text().trim();
    copy = $(this).data('copy');
    return Work.summaryFilter(filter, copy);
  },
  summaryFilter: function(filter, copy) {
    _.off('.summary .filters > .inner > .filtermenu > .filter');
    _.on(".summary .filters > .inner > .filtermenu > .filter.filter_" + filter);
    if (copy) {
      $('.summary > .hero > .copy2').text(copy);
    }
    if (filter === 'all') {
      _.on('.summary > .thumbs > .thumb');
      return true;
    }
    _.off('.summary > .thumbs > .thumb');
    return setTimeout(function() {
      return $('.summary > .thumbs > .thumb').each(function(i, el) {
        var filters;
        filters = $(el).data('filters');
        if (filters.indexOf(filter) !== -1) {
          return _.on($(el));
        } else {
          return _.off($(el));
        }
      });
    }, 200);
  },
  filterHandler: function() {
    var t;
    t = $(this);
    return $('html, body').animate({
      scrollTop: $(".filter_mark.filter_" + (t.html())).offset().top
    }, 500);
  },
  projectHandler: function() {
    var project;
    project = $(this).data('project');
    history.pushState(null, null, "/work/#" + project);
    document.body.scrollTop = document.documentElement.scrollTop = 0;
    return Work.load(project);
  },
  summary: function(filter) {
    var srcs;
    location.hash = '';
    setTimeout(function() {
      $('.orbit').removeClass(function(index, css) {
        return (css.match(/\borbit_\S+/g) || []).join(' ');
      });
      return $('.dbar').removeClass(function(index, css) {
        return (css.match(/\bbar_\S+/g) || []).join(' ');
      });
    }, 500);
    _.off('.project');
    _.on('.orbit');
    dbar.i();
    srcs = [];
    $('.summary > .thumbs > .thumb > .inner').each(function(i, el) {
      return srcs.push(Global.srcFromStyle($(el)));
    });
    return Global.preload(srcs, function(progress) {
      return dbar.perc(progress);
    }, function(complete) {
      dbar.d();
      _.off('.orbit');
      _.on('.summary');
      if (filter) {
        return Work.summaryFilter(filter);
      }
    });
  },
  load: function(project) {
    var srcs;
    _.off('.project, .summary');
    $('.orbit').addClass("orbit_" + project);
    $('.dbar').addClass("bar_" + project);
    _.on('.orbit');
    dbar.i();
    $('.dbar').addClass("bar_" + project);
    srcs = Work.srcs(project);
    document.body.scrollTop = document.documentElement.scrollTop = 0;
    return Global.preload(srcs, function(progress) {
      return dbar.perc(progress);
    }, function(complete) {
      dbar.d();
      _.off('.orbit');
      $(".project img").attr('src', '');
      $(".project_" + project + " img").each(function(i, v) {
        return $(v).attr('src', "/img/work/" + project + "/1440/" + ($(v).data('src')));
      });
      _.on(".project_" + project);
      return setTimeout(function() {
        $('.orbit').removeClass(function(index, css) {
          return (css.match(/\borbit_\S+/g) || []).join(' ');
        });
        return $('.dbar').removeClass(function(index, css) {
          return (css.match(/\bbar_\S+/g) || []).join(' ');
        });
      }, 500);
    });
  },
  srcs: function(project) {
    var srcs;
    srcs = [Global.srcFromStyle($(".project_" + project + " > .cover"))];
    $(".project_" + project + " img").each(function(i, v) {
      return srcs.push("/img/work/" + project + "/1440/" + ($(v).data('src')));
    });
    return srcs;
  }
};

//# sourceMappingURL=data:application/json;base64,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YSxPQUFiLEdBQXFCLFFBQXJCLEdBQTRCLENBQUMsQ0FBQSxDQUFFLENBQUYsQ0FBSSxDQUFDLElBQUwsQ0FBVSxLQUFWLENBQUQsQ0FBdEM7SUFEZ0MsQ0FBbEM7QUFHQSxXQUFPO0VBUEgsQ0FuSk4iLCJmaWxlIjoid29yay5qcyIsInNvdXJjZVJvb3QiOiIvc291cmNlLyIsInNvdXJjZXNDb250ZW50IjpbIlxuV29yayA9XG4gIGhhc2g6IGZhbHNlXG4gIGNwcm9qZWN0OiBmYWxzZVxuXG4gIGk6IC0+XG5cbiAgICBpZiBPYmplY3Qua2V5cyhwcm9qZWN0cykuaW5kZXhPZihsb2NhdGlvbi5oYXNoLnJlcGxhY2UoJyMnLCcnKSkgaXNudCAtMVxuICAgICAgcHJvamVjdCA9IGxvY2F0aW9uLmhhc2gucmVwbGFjZSAnIycsICcnXG4gICAgICBXb3JrLmNwcm9qZWN0ID0gcHJvamVjdFxuICAgICAgV29yay5sb2FkIHByb2plY3RcbiAgICBlbHNlXG4gICAgICBXb3JrLnN1bW1hcnkoKVxuXG4gICAgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3AgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wID0gMFxuXG4gICAgV29yay5oYW5kbGVycygpXG5cbiAgaGFuZGxlcnM6IC0+XG5cbiAgICAkKCcucHJvamVjdHMgPiAuc3VtbWFyeSA+IC50aHVtYnMgPiAudGh1bWIsIC5yZWxhdGVkID4gLmlubmVyID4gLnJlbGF0ZWRzID4gLnRodW1iJykub24gJ2NsaWNrJywgV29yay5wcm9qZWN0SGFuZGxlclxuICAgICQoJy5wcm9qZWN0IC5maWx0ZXJzID4gLmlubmVyID4gLmZpbHRlcm1lbnUgPiAuZmlsdGVyJykub24gJ2NsaWNrJywgV29yay5maWx0ZXJIYW5kbGVyXG4gICAgJCgnLnN1bW1hcnkgLmZpbHRlcnMgPiAuaW5uZXIgPiAuZmlsdGVybWVudSA+IC5maWx0ZXInKS5vbiAnY2xpY2snLCBXb3JrLnN1bW1hcnlGaWx0ZXJIYW5kbGVyXG4gICAgJCgnLnByb2plY3QgPiAuZGVzY3JpcHRpb24gPiAuZmlsdGVycyA+IC5maWx0ZXInKS5vbiAnY2xpY2snLCBXb3JrLnByb2plY3RGaWx0ZXJIYW5kbGVyXG4gICAgJCh3aW5kb3cpLm9uICdwb3BzdGF0ZScsIFdvcmsucG9wXG5cbiAgcG9wOiAoZSkgLT5cblxuICAgIGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCA9IDBcblxuICAgIGlmIE9iamVjdC5rZXlzKHByb2plY3RzKS5pbmRleE9mKGxvY2F0aW9uLmhhc2gucmVwbGFjZSgnIycsJycpKSBpc250IC0xXG4gICAgICBwcm9qZWN0ID0gbG9jYXRpb24uaGFzaC5yZXBsYWNlICcjJywgJydcbiAgICAgIFdvcmsuY3Byb2plY3QgPSBwcm9qZWN0XG4gICAgICBXb3JrLmxvYWQgcHJvamVjdFxuICAgIGVsc2VcbiAgICAgIFdvcmsuc3VtbWFyeSgpXG4gICAgICBfLm9uICcuc3VtbWFyeSA+IC50aHVtYnMgPiAudGh1bWInXG4gICAgICBfLm9mZiAnLnN1bW1hcnkgPiAuZmlsdGVycyA+IC5pbm5lciA+IC5maWx0ZXJtZW51ID4gLmZpbHRlcidcbiAgICAgIF8ub24gJy5zdW1tYXJ5ID4gLmZpbHRlcnMgPiAuaW5uZXIgPiAuZmlsdGVybWVudSA+IC5maWx0ZXJfYWxsJ1xuXG4gIHByb2plY3RGaWx0ZXJIYW5kbGVyOiAtPlxuXG4gICAgZmlsdGVyID0gJCh0aGlzKS50ZXh0KClcbiAgICBXb3JrLnN1bW1hcnkoZmlsdGVyKVxuXG4gIHN1bW1hcnlGaWx0ZXJIYW5kbGVyOiAtPlxuICAgIGZpbHRlciA9ICQodGhpcykudGV4dCgpLnRyaW0oKVxuICAgIGNvcHkgPSAkKHRoaXMpLmRhdGEgJ2NvcHknXG4gICAgV29yay5zdW1tYXJ5RmlsdGVyIGZpbHRlciwgY29weVxuXG4gIHN1bW1hcnlGaWx0ZXI6IChmaWx0ZXIsIGNvcHkpIC0+XG5cbiAgICAjZG9jdW1lbnQuYm9keS5zY3JvbGxUb3AgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wID0gMFxuXG4gICAgXy5vZmYgJy5zdW1tYXJ5IC5maWx0ZXJzID4gLmlubmVyID4gLmZpbHRlcm1lbnUgPiAuZmlsdGVyJ1xuICAgIF8ub24gXCIuc3VtbWFyeSAuZmlsdGVycyA+IC5pbm5lciA+IC5maWx0ZXJtZW51ID4gLmZpbHRlci5maWx0ZXJfI3tmaWx0ZXJ9XCJcblxuICAgICQoJy5zdW1tYXJ5ID4gLmhlcm8gPiAuY29weTInKS50ZXh0IGNvcHkgaWYgY29weVxuXG4gICAgaWYgZmlsdGVyIGlzICdhbGwnXG4gICAgICBfLm9uICcuc3VtbWFyeSA+IC50aHVtYnMgPiAudGh1bWInXG4gICAgICByZXR1cm4gdHJ1ZVxuXG4gICAgXy5vZmYgJy5zdW1tYXJ5ID4gLnRodW1icyA+IC50aHVtYidcbiAgICBzZXRUaW1lb3V0IC0+XG4gICAgICAkKCcuc3VtbWFyeSA+IC50aHVtYnMgPiAudGh1bWInKS5lYWNoIChpLCBlbCkgLT5cbiAgICAgICAgZmlsdGVycyA9ICQoZWwpLmRhdGEgJ2ZpbHRlcnMnXG4gICAgICAgIGlmIGZpbHRlcnMuaW5kZXhPZihmaWx0ZXIpIGlzbnQgLTFcbiAgICAgICAgICBfLm9uICQoZWwpXG4gICAgICAgIGVsc2VcbiAgICAgICAgICBfLm9mZiAkKGVsKVxuICAgICwgMjAwXG5cbiAgZmlsdGVySGFuZGxlcjogLT5cbiAgICB0ID0gJCB0aGlzXG4gICAgJCgnaHRtbCwgYm9keScpLmFuaW1hdGUoXG4gICAgICBzY3JvbGxUb3A6ICQoXCIuZmlsdGVyX21hcmsuZmlsdGVyXyN7dC5odG1sKCl9XCIpLm9mZnNldCgpLnRvcFxuICAgICwgNTAwKVxuXG4gIHByb2plY3RIYW5kbGVyOiAtPlxuXG4gICAgcHJvamVjdCA9ICQodGhpcykuZGF0YSAncHJvamVjdCdcbiAgICBoaXN0b3J5LnB1c2hTdGF0ZSBudWxsLCBudWxsLCBcIi93b3JrLyMje3Byb2plY3R9XCJcblxuICAgIGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCA9IDBcbiAgICBXb3JrLmxvYWQgcHJvamVjdFxuXG4gIHN1bW1hcnk6IChmaWx0ZXIpIC0+XG4gICAgbG9jYXRpb24uaGFzaCA9ICcnXG5cbiAgICBzZXRUaW1lb3V0IC0+XG4gICAgICAkKCcub3JiaXQnKS5yZW1vdmVDbGFzcyAoaW5kZXgsIGNzcykgLT5cbiAgICAgICAgKGNzcy5tYXRjaCgvXFxib3JiaXRfXFxTKy9nKSBvciBbXSkuam9pbiAnICdcbiAgICAgICQoJy5kYmFyJykucmVtb3ZlQ2xhc3MgKGluZGV4LCBjc3MpIC0+XG4gICAgICAgIChjc3MubWF0Y2goL1xcYmJhcl9cXFMrL2cpIG9yIFtdKS5qb2luICcgJ1xuICAgICwgNTAwXG5cbiAgICBfLm9mZiAnLnByb2plY3QnXG4gICAgXy5vbiAnLm9yYml0J1xuICAgIGRiYXIuaSgpXG5cbiAgICBzcmNzID0gW11cblxuICAgICQoJy5zdW1tYXJ5ID4gLnRodW1icyA+IC50aHVtYiA+IC5pbm5lcicpLmVhY2ggKGksIGVsKSAtPlxuICAgICAgc3Jjcy5wdXNoKEdsb2JhbC5zcmNGcm9tU3R5bGUoJChlbCkpKVxuXG4gICAgR2xvYmFsLnByZWxvYWQgc3JjcyxcbiAgICAgIChwcm9ncmVzcykgLT5cbiAgICAgICAgZGJhci5wZXJjIHByb2dyZXNzXG4gICAgICAsIChjb21wbGV0ZSkgLT5cbiAgICAgICAgZGJhci5kKClcbiAgICAgICAgXy5vZmYgJy5vcmJpdCdcbiAgICAgICAgXy5vbiAnLnN1bW1hcnknXG4gICAgICAgIFdvcmsuc3VtbWFyeUZpbHRlcihmaWx0ZXIpIGlmIGZpbHRlclxuXG4gIGxvYWQ6IChwcm9qZWN0KSAtPlxuICAgIF8ub2ZmICcucHJvamVjdCwgLnN1bW1hcnknXG5cbiAgICAkKCcub3JiaXQnKS5hZGRDbGFzcyBcIm9yYml0XyN7cHJvamVjdH1cIlxuICAgICQoJy5kYmFyJykuYWRkQ2xhc3MgXCJiYXJfI3twcm9qZWN0fVwiXG5cbiAgICBfLm9uICcub3JiaXQnXG5cbiAgICBkYmFyLmkoKVxuICAgICQoJy5kYmFyJykuYWRkQ2xhc3MgXCJiYXJfI3twcm9qZWN0fVwiXG4gICAgc3JjcyA9IFdvcmsuc3JjcyBwcm9qZWN0XG5cbiAgICBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3AgPSAwXG5cbiAgICBHbG9iYWwucHJlbG9hZCBzcmNzLFxuICAgICAgKHByb2dyZXNzKSAtPlxuICAgICAgICBkYmFyLnBlcmMgcHJvZ3Jlc3NcbiAgICAgICwgKGNvbXBsZXRlKSAtPlxuICAgICAgICBkYmFyLmQoKVxuICAgICAgICBfLm9mZiAnLm9yYml0J1xuICAgICAgICAkKFwiLnByb2plY3QgaW1nXCIpLmF0dHIgJ3NyYycsICcnXG5cbiAgICAgICAgJChcIi5wcm9qZWN0XyN7cHJvamVjdH0gaW1nXCIpLmVhY2ggKGksIHYpIC0+XG4gICAgICAgICAgJCh2KS5hdHRyICdzcmMnLCBcIi9pbWcvd29yay8je3Byb2plY3R9LzE0NDAvI3skKHYpLmRhdGEoJ3NyYycpfVwiXG5cbiAgICAgICAgXy5vbiBcIi5wcm9qZWN0XyN7cHJvamVjdH1cIlxuICAgICAgICBcbiAgICAgICAgc2V0VGltZW91dCAtPlxuICAgICAgICAgICQoJy5vcmJpdCcpLnJlbW92ZUNsYXNzIChpbmRleCwgY3NzKSAtPlxuICAgICAgICAgICAgKGNzcy5tYXRjaCgvXFxib3JiaXRfXFxTKy9nKSBvciBbXSkuam9pbiAnICdcbiAgICAgICAgICAkKCcuZGJhcicpLnJlbW92ZUNsYXNzIChpbmRleCwgY3NzKSAtPlxuICAgICAgICAgICAgKGNzcy5tYXRjaCgvXFxiYmFyX1xcUysvZykgb3IgW10pLmpvaW4gJyAnXG4gICAgICAgICwgNTAwXG5cbiAgc3JjczogKHByb2plY3QpIC0+XG5cbiAgICBzcmNzID0gW0dsb2JhbC5zcmNGcm9tU3R5bGUoJChcIi5wcm9qZWN0XyN7cHJvamVjdH0gPiAuY292ZXJcIikpXVxuXG4gICAgJChcIi5wcm9qZWN0XyN7cHJvamVjdH0gaW1nXCIpLmVhY2ggKGksIHYpIC0+XG4gICAgICBzcmNzLnB1c2ggXCIvaW1nL3dvcmsvI3twcm9qZWN0fS8xNDQwLyN7JCh2KS5kYXRhKCdzcmMnKX1cIlxuXG4gICAgcmV0dXJuIHNyY3NcblxuXG4iXX0=
